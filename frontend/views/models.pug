extends layout.pug

block content
  #app-container(class="min-h-screen flex")
    include includes/sidebar.pug
    
    main(class="ml-64 flex-1 p-8 bg-slate-50 min-h-screen")
      #page-models.page-content.active
        header(class="flex justify-between items-center mb-8")
          div
            h2(class="text-2xl font-bold text-slate-800") 模型管理
            p(class="text-slate-500 text-sm") 管理本地预训练模型文件
          div(class="flex gap-3")
            button(class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700", onclick="showModal('uploadModelModal')")
              i(class="fas fa-upload mr-2")
              | 上传新模型

        //- Models Grid
        .grid.grid-cols-1.gap-6(class="md:grid-cols-2 lg:grid-cols-3")
          if models && models.length
            each model in models
              div(class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 hover:shadow-md transition group")
                div(class="flex justify-between items-start mb-4")
                  div(class="w-12 h-12 rounded-lg bg-blue-50 flex items-center justify-center text-blue-500 group-hover:bg-blue-600 group-hover:text-white transition")
                    i(class="fas fa-brain text-xl")
                  div(class="flex gap-2")
                    button(class="text-slate-400 hover:text-red-500 p-1", onclick=`deleteModel('${model.name}')`)
                      i(class="fas fa-trash-alt")
                
                h3(class="text-lg font-bold text-slate-800 mb-1") #{model.name}
                p(class="text-xs text-slate-400 font-mono mb-4") 更新于: #{new Date(model.updated_at).toLocaleString()}
                
                div(class="flex items-center justify-between pt-4 border-t border-slate-50")
                  div(class="text-xs font-bold text-slate-500 uppercase tracking-wider") 大小
                  div(class="text-sm font-mono text-slate-700") #{(model.size / (1024 * 1024 * 1024)).toFixed(2)} GB

          else
            div(class="col-span-full text-center py-20 bg-white rounded-xl border-2 border-dashed border-slate-200")
              div(class="inline-block p-4 rounded-full bg-slate-50 mb-4")
                i(class="fas fa-folder-open text-4xl text-slate-300")
              p(class="text-slate-500 font-bold") 暂无模型文件
              p(class="text-xs text-slate-400 mt-1") 请点击“上传新模型”开始

  //- Modals

  //- Upload Model Modal (Updated for Chunked Upload)
  #uploadModelModal.modal
    .bg-white.rounded-xl.shadow-xl.max-w-lg.w-full.p-6
      .flex.justify-between.items-center.mb-6
        h3(class="text-lg font-bold text-slate-800") 上传预训练模型
        button(onclick="hideModal('uploadModelModal')", class="text-slate-400 hover:text-slate-600")
          i(class="fas fa-times")
      
      form#uploadModelForm
        .space-y-6
          div
            label(class="block text-sm font-bold text-slate-700 mb-2") 模型名称
            input(type="text", name="name", id="modelName", placeholder="例如: Qwen3-1.7B", class="w-full border rounded-lg p-2.5 text-sm focus:ring-blue-500 focus:border-blue-500 outline-none", required)
            p(class="mt-1 text-[10px] text-slate-400") 模型将保存在 deployments/models/{名称}
          
          div
            label(class="block text-sm font-bold text-slate-700 mb-2") 模型文件 (.tar / .tar.gz)
            input(type="file", name="tarFile", id="tarFile", accept=".tar,.gz,.tgz", class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100", required)
            //- Progress
            .mt-2.hidden#tarProgressContainer
                .flex.justify-between.text-xs.mb-1
                    span#tarStatus 等待上传...
                    span#tarPercent 0%
                .w-full.bg-slate-200.rounded-full.h-2
                    .bg-blue-600.h-2.rounded-full.transition-all.duration-300(style="width: 0%")#tarProgressBar
          
          div
            label(class="block text-sm font-bold text-slate-700 mb-2") 校验文件 (.sha256)
            input(type="file", name="sumFile", id="sumFile", accept=".sha256,.txt", class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100", required)
            //- Progress
            .mt-2.hidden#sumProgressContainer
                .flex.justify-between.text-xs.mb-1
                    span#sumStatus 等待上传...
                    span#sumPercent 0%
                .w-full.bg-slate-200.rounded-full.h-2
                    .bg-green-500.h-2.rounded-full.transition-all.duration-300(style="width: 0%")#sumProgressBar

        .mt-8.flex.justify-end.gap-3
          button(type="button", id="pauseBtn", class="hidden px-4 py-2 text-sm font-bold text-orange-600 bg-orange-50 hover:bg-orange-100 rounded-lg") 暂停
          button(type="button", id="resumeBtn", class="hidden px-4 py-2 text-sm font-bold text-green-600 bg-green-50 hover:bg-green-100 rounded-lg") 继续
          button(type="button", onclick="hideModal('uploadModelModal')", class="px-4 py-2 text-sm font-bold text-slate-600 hover:bg-slate-100 rounded-lg") 取消
          button(type="submit", id="uploadSubmitBtn", class="px-6 py-2 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-lg shadow-lg shadow-blue-100") 开始上传

  script(src="/js/models.js")